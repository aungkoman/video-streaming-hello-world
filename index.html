<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Local Video Streamer</title>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
</head>
<body>

    <h1>Upload and Stream</h1>

    <input type="file" id="fileInput" accept="video/*">
    <button onclick="uploadVideo()">Upload & Process</button>
    <p id="status"></p>

    <hr>

    <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" width="640" height="360">
        </video>

    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    
    <script>
        async function uploadVideo() {
            const fileInput = document.getElementById('fileInput');
            const status = document.getElementById('status');
            
            if(fileInput.files.length === 0) {
                alert("Please select a file");
                return;
            }

            const formData = new FormData();
            formData.append('video', fileInput.files[0]);

            status.innerText = "Uploading and Transcoding (Wait for it... this takes CPU)...";

            try {
                // Send to backend
                const response = await fetch('http://localhost:3000/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                status.innerText = "Done! Video is ready.";
                console.log("Stream URL:", data.streamUrl);

                // Load video into player
                var player = videojs('my-video');
                player.src({
                    src: data.streamUrl,
                    type: 'application/x-mpegURL' // This mimetype tells browser it's HLS
                });
                player.play();

            } catch (error) {
                console.error(error);
                status.innerText = "Error uploading.";
            }
        }
    </script>
</body>
</html>